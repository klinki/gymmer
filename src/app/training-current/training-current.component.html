<div class="container page-content">
  @if (training(); as training;) {
    <!-- Header with Timer -->
    <div class="training-header">
       <div class="training-info">
         <h1 class="mat-h2">{{training.name}}</h1>
         @if (training.startDate != null) {
            <div class="timer" style="display: block;">{{ trainingRunningTime() | duration }}</div>
            <div class="start-time">Started: {{ training.startDate | date: 'shortTime' }}</div>
         } @else {
            <div class="timer">00:00:00</div>
         }
       </div>

       <!-- Menu Button -->
       <button mat-icon-button [matMenuTriggerFor]="menu" aria-label="Training options">
          <mat-icon>more_vert</mat-icon>
       </button>
       <mat-menu #menu="matMenu">
          <button mat-menu-item (click)="deleteCurrentSession()">
            <mat-icon>delete</mat-icon>
            <span>Discard Session</span>
          </button>
       </mat-menu>
    </div>

    <!-- Exercises List -->
    <div class="exercise-list">
      @for (exercise of training.exercises; track $index) {
        <mat-card class="exercise-card" [class.done]="exercise.series.length > 0" (click)="startExercise(exercise)" matRipple>
          <div class="exercise-content">
             <div class="exercise-icon">
                @if (exercise.series.length > 0) {
                   <mat-icon class="done-icon">check_circle</mat-icon>
                } @else {
                   <mat-icon>fitness_center</mat-icon>
                }
             </div>
             <div class="exercise-details">
                <div class="exercise-name">{{exercise.name}}</div>
                <div class="exercise-stats">
                   @if (exercise.series.length > 0) {
                      {{exercise.series.length}} Sets
                   } @else {
                      Not started
                   }
                </div>
             </div>
             <mat-icon>chevron_right</mat-icon>
          </div>
        </mat-card>
      }

      <!-- Hint if no exercises -->
      @if (training.exercises.length === 0) {
        <div class="empty-state" style="text-align: center; padding: 32px; opacity: 0.6;">
           <mat-icon style="font-size: 48px; width: 48px; height: 48px;">fitness_center</mat-icon>
           <p>Add exercises to start your workout</p>
        </div>
      }
    </div>
  }

  <!-- Floating Controls (Fixed at bottom) -->
  <div class="controls-container">
    <div class="main-controls">
       @if (training()?.startDate == null || training()?.endDate != null) {
          <!-- Not Started State -->
          <button mat-fab extended color="primary" (click)="start()">
             <mat-icon>play_arrow</mat-icon>
             <span>START</span>
          </button>

          <button mat-fab (click)="addExercise()" aria-label="Add Exercise">
             <mat-icon>add</mat-icon>
          </button>
       } @else {
          <!-- Started State: Keep order consistent (Main Action Left, Secondary Right or vice versa) -->
          <!-- User asked to NOT switch positions. Previously: Start (Left), Add (Right). -->
          <!-- Now: Stop (Left - replaces Start), Add (Right - stays same). -->

          <button mat-fab extended color="warn" (click)="stop()">
             <mat-icon>stop</mat-icon>
             <span>STOP</span>
          </button>

          <button mat-fab (click)="addExercise()" aria-label="Add Exercise">
             <mat-icon>add</mat-icon>
          </button>
       }
    </div>
  </div>
</div>
